https://stackoverflow.com/questions/24225647/docker-a-way-to-give-access-to-a-host-usb-or-serial-device

https://github.com/dimalo/klipper-web-control-docker/blob/main/klipper/Dockerfile

https://github.com/dw-0/kiauh

https://serverfault.com/questions/1053187/systemd-fails-to-run-in-a-docker-container-when-using-cgroupv2-cgroupns-priva/1054414#1054414

sudo docker run -d --name klipper --device /dev/ttyUSB0:/dev/ttyUSB0 -v /home/lrgex/klipper:/home/lrgex -p 5001:80 -p 7125:7125 --privileged --cap-add SYS_ADMIN --security-opt seccomp=unconfined --cgroup-parent=docker.slice --cgroupns private --tmpfs /tmp --tmpfs /run --tmpfs /run/lock lrgex/klipper-docker



sudo docker run -d --name klipper -p 5001:80 -p 7125:7125 --privileged --cap-add SYS_ADMIN --security-opt seccomp=unconfined --cgroup-parent=docker.slice --cgroupns private --tmpfs /tmp --tmpfs /run --tmpfs /run/lock lrgex/klipper-docker


sudo docker run -d --name klipper --device /dev/ttyUSB0:/dev/ttyUSB0 -p 5001:80 -p 7125:7125 -e PACKAGES="klipper moonraker fluidd" -v klipper-config:/home/lrgex --privileged --cap-add SYS_ADMIN --security-opt seccomp=unconfined --cgroup-parent=docker.slice --cgroupns private --tmpfs /tmp --tmpfs /run --tmpfs /run/lock lrgex/klipper-docker

sudo docker run -d --name klipper -p 5001:80 -p 7125:7125 -e PACKAGES="klipper moonraker fluidd" --privileged --cap-add SYS_ADMIN --security-opt seccomp=unconfined --cgroup-parent=docker.slice --cgroupns private --tmpfs /tmp --tmpfs /run --tmpfs /run/lock lrgex/klipper-docker:2.0


sudo docker run -d --name klipper --device /dev/ttyUSB0:/dev/ttyUSB0 -p 5001:80 -p 7125:7125 -v klipper-config:/home/lrgex/printer_data --privileged --cap-add SYS_ADMIN --security-opt seccomp=unconfined --cgroup-parent=docker.slice --cgroupns private --tmpfs /tmp --tmpfs /run --tmpfs /run/lock klipper


sudo docker run -d \
-e KEEP_VERSIONS="2" \
-v /mnt/fastshare/klipper:/backup \
-v klipper-config:/source:ro \
-v /var/run/docker.sock:/var/run/docker.sock \
-e LOCAL_BACKUP="true" \
-e TZ="Asia/Riyadh" \
--restart no \
--name backarosa-klipper lrgex/backarosa backup




sudo docker run -d \
--name klipper \
--device /dev/ttyUSB0:/dev/ttyUSB0 \
-p 5001:80 \
-p 7125:7125 \
-e PACKAGES="klipper moonraker fluidd" \
-v klipper-config:/home/lrgex \
--privileged \
--cap-add SYS_ADMIN \
--security-opt seccomp=unconfined \
--cgroup-parent=docker.slice \
--cgroupns private \
--tmpfs /tmp \
--tmpfs /run \
--tmpfs /run/lock \
lrgex/klipper-docker


sudo docker run -d \
-e KEEP_VERSIONS="2" \
-v /mnt/backups/klipper:/backup \
-v klipper-config:/source:ro \
-v /var/run/docker.sock:/var/run/docker.sock \
-e LOCAL_BACKUP="true" \
-e TZ="Asia/Riyadh" \
--restart no \
--name backarosa-klipper lrgex/backarosa backup


docker run --rm \
-v /mnt/fastshare/klipper:/backup \
-v klipper-config:/source \
-e LOCAL_BACKUP="true" \
-e TZ="Asia/Riyadh" \
-e RESTORE_VERSION="0" \
lrgex/backarosa restore


version: '3.8'

services:
  klipper:
    image: klipper
    container_name: klipper
    privileged: true
    cap_add:
      - SYS_ADMIN
    security_opt:
      - seccomp=unconfined
    cgroup_parent: docker.slice
    cgroup: private
    tmpfs:
      - /tmp
      - /run
      - /run/lock
    volumes:
      - klipper-config:/home/lrgex/printer_data
    ports:
      - "5001:80"
      - "7125:7125"
    devices:
      - "/dev/ttyUSB0:/dev/ttyUSB0"

  klipper-backarosa:
    image: lrgex/backarosa
    container_name: klipper-backarosa
    restart: no
    command: backup
    volumes:
      - /mnt/fastshare/klipper:/backup
      - klipper-config:/source:ro
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - KEEP_VERSIONS=2
      - LOCAL_BACKUP=true
      - TZ=Asia/Riyadh
      - CRON=0 8 * * *

volumes:
  klipper-config:
